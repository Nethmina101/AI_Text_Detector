<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Result</title>
  <style>
    body { font-family: Arial, sans-serif; }
    .para { margin: 12px 0; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .ai { background: #fff3cd; }
    .human { background: #f8f9fa; }
    .meta { font-size: 12px; color: #555; margin-top: 6px; }
    mark { background: #ffe066; }
  </style>
</head>
<body>
  <h2>Document Result</h2>

  <p>
    <b>AI%:</b> {{ doc.ai_percent | round(2) }}%
    &nbsp;|&nbsp; <b>Mean prob:</b> {{ doc.mean_prob | round(3) }}
    &nbsp;|&nbsp; <b>Max prob:</b> {{ doc.max_prob | round(3) }}
    &nbsp;|&nbsp; <b>Paragraphs:</b> {{ doc.n_paragraphs }}
    &nbsp;|&nbsp; <b>Flagged:</b> {{ doc.n_flagged }}
  </p>

  <hr>

  {% for r in paras %}
    {% set is_ai = r.prob_ensemble >= threshold %}
    <div class="para {{ 'ai' if is_ai else 'human' }}">
      {% if is_ai %}
        <p><mark>{{ r.paragraph }}</mark></p>
      {% else %}
        <p style="white-space: pre-wrap;">{{ r.paragraph }}</p>
      {% endif %}
      <div class="meta">
        ensemble={{ r.prob_ensemble | round(3) }},
        svm={{ r.prob_tfidf_svm | round(3) }},
        xgb={{ r.prob_stylometry_xgb | round(3) }},
        ppl={{ r.perplexity | round(1) }}
      </div>
    </div>
  {% endfor %}
</body>
</html>
